{% extends "base.html" %}

{% block title %}My Products - Warranty System{% endblock %}

{% block content %}
<div class="">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h2 class="text-2xl font-semibold"><i class="fas fa-box mr-2"></i> My Products</h2>
            <p class="text-sm text-slate-500">Manage registered products and warranty details</p>
        </div>
        <div>
            <a href="{{ url_for('customer.add_product') }}" class="inline-flex items-center px-4 py-2 bg-accent text-white rounded-md hover:opacity-95">
                <i class="fas fa-plus mr-2"></i> Add New Product
            </a>
        </div>
    </div>

    {% if products.items %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for product in products.items %}
        <div class="bg-white rounded-lg shadow p-4 flex flex-col">
            <div class="flex items-center gap-4">
                <div class="w-20 h-20 bg-slate-100 rounded-md overflow-hidden flex items-center justify-center">
                    {% if product.invoice_image %}
                        <img src="{{ url_for('static', filename=product.invoice_image) }}" alt="Invoice" class="object-cover w-full h-full">
                    {% else %}
                        <i class="fas fa-file-invoice text-slate-400 text-2xl"></i>
                    {% endif %}
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-medium">{{ product.product_name }}</h3>
                    <p class="text-sm text-slate-500">{{ product.brand }} • {{ product.category|title }}</p>
                    <p class="text-sm text-slate-400 mt-2">SN: {{ product.serial_number }}</p>
                </div>
            </div>

            <div class="mt-4 flex-1">
                <div class="flex items-center justify-between">
                    <div>
                        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-md {% if product.warranty_status == 'active' %}bg-green-100 text-green-800{% elif product.warranty_status == 'expiring_soon' %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {{ product.warranty_status|replace('_', ' ')|upper }}
                        </span>
                    </div>
                    <div class="text-sm text-slate-500">Expires: {{ product.warranty_expiry.strftime('%b %d, %Y') }}</div>
                </div>
            </div>

            <div class="mt-4 flex gap-2">
                <a href="{{ url_for('customer.product_detail', product_id=product.id) }}" class="flex-1 inline-flex justify-center items-center px-3 py-2 bg-primary text-white rounded-md">View</a>
                <a href="{{ url_for('customer.edit_product', product_id=product.id) }}" class="inline-flex items-center px-3 py-2 border rounded-md">Edit</a>
                <form method="POST" action="{{ url_for('customer.delete_product', product_id=product.id) }}" onsubmit="return confirm('Delete this product?');">
                    <button type="submit" class="inline-flex items-center px-3 py-2 text-red-600 border border-red-100 rounded-md">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if products.pages > 1 %}
    <div class="mt-6 flex justify-center">
        <nav class="inline-flex -space-x-px">
            {% if products.has_prev %}
            <a href="{{ url_for('customer.products', page=products.prev_num) }}" class="px-3 py-1 bg-white border">Prev</a>
            {% endif %}
            {% for page_num in products.iter_pages() %}
                {% if page_num %}
                    {% if page_num == products.page %}
                    <span class="px-3 py-1 bg-primary text-white border">{{ page_num }}</span>
                    {% else %}
                    <a href="{{ url_for('customer.products', page=page_num) }}" class="px-3 py-1 bg-white border">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                <span class="px-3 py-1">…</span>
                {% endif %}
            {% endfor %}
            {% if products.has_next %}
            <a href="{{ url_for('customer.products', page=products.next_num) }}" class="px-3 py-1 bg-white border">Next</a>
            {% endif %}
        </nav>
    </div>
    {% endif %}

    {% else %}
    <div class="bg-white p-6 rounded-lg shadow text-center">
        <p class="text-slate-600">No products yet.</p>
        <a href="{{ url_for('customer.add_product') }}" class="inline-flex items-center mt-3 px-4 py-2 bg-accent text-white rounded-md">Register your first product</a>
    </div>
    {% endif %}
</div>
{% endblock %}
